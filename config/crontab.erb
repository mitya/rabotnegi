<% 
  @user = "apprunner"
  @path = "/apps/rabotnegi_prod/current"
  @env = 'production'

  def rake(task)
    "#{@user} cd #{@path} && RAILS_ENV=#{@env} bundle exec rake --trace --silent #{task} >> #{@path}/log/cron.log 2>> #{@path}/log/cron-errors.log"
  end

  def runner(task)
    "#{@user} cd #{@path} && script/rails runner -e #{@env} #{task} >> #{@path}/log/cron.log 2>> #{@path}/log/cron-errors.log"
  end

  # copy (not symlink) to /etc/cron.d/rabotnegi
  # m h dom mon dow user command
  # */d
%>

MAILTO=dmitry.sokurenko@gmail.com
PATH=$PATH:/usr/local/bin/:/usr/bin:/bin
RUBYOPT="-Ku"
RAILS_PROC='cron'

# 30 3 * * * <%= @user %> cd <%= @path %> && script/rails runner -e production "RabotaRu.load" >> <%= @path %>/log/cron.log
#  0 3 * * * <%= @user %> cd <%= @path %> && script/rails runner -e production "Vacancy.cleanup" >> <%= @path %>/log/cron.log
#  0 4,16 * * * <%= @user %> cd <%= @path %> && RAILS_ENV=production bundle exec rake --trace --silent data:dump dest=/apps/data db=rabotnegi_prod >> <%= @path %>/log/cron.log 2>> <%= @path %>/log/cron-errors.log

 30 3 * * * <%= runner "RabotaRu.load" %>
  0 3 * * * <%= runner "Vacancy.cleanup" %>
  0 4,16 * * * <%= rake "data:dump dest=/apps/data db=rabotnegi_prod" %>
  */10 * * * * <%= rake "cron:ping" %>
