set daemon 300
# set mailserver localhost
# set alert dsokurenko@gmail.com
set httpd port 2812
	allow admin:monit
	allow localhost
	allow sokurenko.name
 
check process mysql
	with pidfile /var/db/mysql/rabotnegi.ru.pid
	# start program = "/usr/local/etc/rc.d/mysql-server start"
	# stop program = "/usr/local/etc/rc.d/mysql-server stop"
	if failed host localhost port 3306 then restart

check process httpd
	with pidfile /var/run/httpd.pid
	# start program "/usr/local/sbin/apachectl start"
	# stop program "/usr/local/sbin/apachectl stop"
	if failed host localhost port 8080 protocol http and request "/" then alert

check process mongrel_4001
	with pidfile /var/run/mongrel.4001.pid
 	# start program "/usr/local/bin/mongrel_rails cluster::start -C /etc/mongrel_cluster/mongrel_cluster.yml --clean --only 4001"
 	# stop program "/usr/local/bin/mongrel_rails cluster::stop -C /etc/mongrel_cluster/mongrel_cluster.yml --clean --only 4001"
 	group mongrels
	if failed host localhost port 4001 protocol http and request "/" timeout 20 seconds then alert
	
check process mongrel_4002
	with pidfile /var/run/mongrel.4002.pid
	# start program "/usr/local/bin/mongrel_rails cluster::start -C /etc/mongrel_cluster/mongrel_cluster.yml --clean --only 4002"
	# stop program "/usr/local/bin/mongrel_rails cluster::stop -C /etc/mongrel_cluster/mongrel_cluster.yml --clean --only 4002"
	group mongrels
	if failed host localhost port 4002 protocol http and request "/" timeout 20 seconds then alert
		
check process pen
	with pidfile /var/run/pen.pid
	# start program "/usr/local/bin/pen -H -p /var/run/pen.pid 80 localhost:4001 localhost:4002"
	# stop program "/usr/local/bin/kill-pen"
	if failed host localhost port 80 protocol http and request "/" timeout 20 seconds then restart
